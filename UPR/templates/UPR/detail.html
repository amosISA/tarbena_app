{% extends "UPR/base.html" %}
{% load staticfiles %}

{% block title %}
    {{ ninventario }} - GEPEMA
{% endblock %}

{% block navbar %}
    {% include 'UPR/snippets/navbar.html' %}
{% endblock %}

{% block content %}

    <div class="container">
        <div class="row justify-content-md-center">
            <div class="col-lg-3 col-xs-12">
                <h5>{{ maquina.tipo_maquina}} <a href="/panel/UPR/maquina/{{ maquina.id }}/change/" target="_blank"><i class="far fa-edit"></i></a></h5>
                {% if maquina.capataz_responsable|stringformat:"s" != request.user.username %}
                    <h3 class="display-4 yellow display-numero">
                {% else %}
                    <h3 class="display-4 display-numero">
                {% endif %}
                <small class="text-muted" style="font-size: 25%;">número inventario: </small><br>{{ maquina.numero_inventario }}</h3>

                {% include 'UPR/snippets/detallesMaquina.html' %}
                {% include 'UPR/snippets/navlinks.html' %}
            </div>
            <div  class="col-lg-9 col-xs-12">
                <h2>INCIDENCIAS MÁQUINA {{ maquina.numero_inventario }} | <input id="myInput" type="text" placeholder="buscar..."> <a href="{% url 'upr:add_incidencia' ninventario=maquina.numero_inventario %}"><i class="fas fa-plus-circle"></i></a></h2>
<!-- mensaje de confirmación / error cuando se envia la incidencia -->
                {% if messages %}
                    {% for message in messages %}
                        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                            <strong>{{ message }}</strong>
                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                    {% endfor %}
                {% endif %}

                <table class="table table-striped" id="tablaHome" border="1">
                    <thead>
                        <tr>
                            <th class="text-center">#</th>
                            <th class="text-center">C</th>
                            <th class="text-center">T</th>
                            <th class="text-center">Id</th>
                            <th scope="col">Tipo Incidencia</th>
                            <th>Fecha</th>
                            <th scope="col">Comentario</th>
                        </tr>
                    </thead>
                    <tbody>
<!-- aqui empezamos a listar las incidencias -->
                    {% for i in incidencias %}
                        <tr>
                            <td class="counter"> {{ forloop.counter }}</td>
                            <td colspan="3" width="15%" class="text-right">
                                <i class="fas fa-exclamation-triangle" style="color: {% if i.cerrado == False %}red{% else %}#ddd{% endif %}"></i>
                                <i class="fas fa-tools" style="color: {% if i.taller == True %}red{% else %}#ddd{% endif %}"></i>
                                <div class="n_incidencia"><a href="/panel/UPR/incidencias/{{ i.id }}/change/" target="_blank" class="n_inventario">{{ i.pk }}</a></div><br>
                                <div class="byanddate"><strong>{{ i.capataz_responsable.last_name }}</strong> {{i.updated|date:"d-m-y H:i"}}</div>
                            </td>
                            <td style="width: 30%" class="celdaTipoIncidencia">
                                <small class="componente">{{ i.tipo_incidencias.grupo_componentes }}</small>
                                {{ i.tipo_incidencias }}
                                <div class="campo_componente">{{ i.campo_componente }}</div>
                            </td>
                            <td width="10%" class="text-center">
                                <small>A: {{ i.fecha|date:"d-m-y" }} {% if i.fechaCerrado != None %}<br> <span style="color: lime">C: {{ i.fechaCerrado|date:"d-m-y" }}</span>{% endif %}</small>
                            </td>
                            <td class="group_component" width="45%">
                                {% if i.mantenimientos != None %}<small class="mantenimientos">{{ i.mantenimientos }}</small>{% endif %}
                                {{ i.comentario|linebreaks }}
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
{% endblock %}

{% block js %}
<script>
    $(document).ready(function() {
        $("#myInput").on("keyup", function() {
            var value = $(this).val().toLowerCase();
            $("#tablaHome tr").filter(function() {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
        });
    });
</script>
{% endblock %}

<!--
    fecha: {{ a.fecha }} <br>
    comentario: {{ a.comentario }}
-->
